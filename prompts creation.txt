Excellent, Ali.
Welcome to **Day 26** â€” this is where your system becomes **commercial-grade**.

Up to now, you built **structure**.
Now we build **intelligence + trust**.

This is what clients actually pay for.

---

# ğŸ¯ DAY 26 GOAL

By the end of today, you will know how to:

âœ… Combine chunks + prompts properly
âœ… Control AI behavior
âœ… Reduce hallucinations
âœ… Increase trust
âœ… Pass enterprise demos

---

# ğŸ§  PART 1 â€” Why RAG Alone Is NOT Enough

Many people think:

> â€œI have vector search â†’ my AI is accurate.â€

Wrong.

Without good prompts:

âŒ AI ignores documents
âŒ AI invents answers
âŒ AI sounds confident but wrong

RAG = engine
Prompt = steering wheel

You need both.

---

# ğŸ—ï¸ PART 2 â€” Professional RAG Prompt Architecture

Every serious system uses **3 layers**:

---

## 1ï¸âƒ£ System Prompt (Identity & Rules)

This never changes.

Example:

```
You are a professional customer support AI for an e-commerce company in the UAE.
You must:
- Use only provided knowledge
- Follow company policy
- Escalate risky cases
- Never guess
- Be polite and formal
```

This sets personality + boundaries.

---

## 2ï¸âƒ£ Context Prompt (Injected Knowledge)

This is where chunks go.

Example:

```
Use the following company policies to answer:

[DOCUMENTS]
{{retrieved_chunks}}
[/DOCUMENTS]
```

This tells AI:

ğŸ‘‰ â€œThis is your brain. Use it.â€

---

## 3ï¸âƒ£ User Prompt (Customer Question)

Example:

```
Customer: Can I get refund after 40 days?
```

---

## Combined = Final Prompt

In code, it becomes:

```
SYSTEM + CONTEXT + USER
```

This is RAG.

---

# ğŸ§© PART 3 â€” The Golden Rule: â€œGrounded Answers Onlyâ€

You must force this rule:

> If answer not in documents â†’ escalate.

Example instruction:

```
If the answer is not clearly stated in the documents,
respond: "This case requires review by our support team."
```

This kills hallucinations.

---

# ğŸ›¡ï¸ PART 4 â€” Trust Prompt Template (You Will Use This Forever)

Save this.

### Professional Support Prompt

```
You are an AI customer support agent.

Rules:
1. Answer ONLY from provided documents.
2. Do NOT use outside knowledge.
3. If uncertain â†’ escalate.
4. If requires_human=true â†’ escalate.
5. Be polite, concise, and professional.
6. Follow UAE regulations.

Documents:
{{context}}

Customer Question:
{{question}}

Provide a compliant response.
```

This is enterprise-grade.

---

# ğŸ§  PART 5 â€” Handling Escalation Automatically

Because you added:

```json
"requires_human": true
```

You can instruct:

```
If any retrieved document has requires_human=true,
do not answer. Escalate.
```

So AI becomes safe.

---

# ğŸ“‰ PART 6 â€” How Hallucinations Actually Happen

AI hallucinates when:

| Cause          | Result   |
| -------------- | -------- |
| No context     | Invents  |
| Weak prompt    | Assumes  |
| Too many docs  | Confuses |
| Vague question | Guesses  |

RAG + Prompt fixes all.

---

# ğŸ”§ PART 7 â€” Chunk Selection Strategy (Very Important)

Do NOT send all chunks.

Send only top 3â€“5.

Why?

Too many = noise.

Use:

```python
top_k = 4
```

Best practice.

---

# ğŸ PART 8 â€” Python Example (Simple)

Later youâ€™ll do something like:

```python
context = "\n".join([c["text"] for c in retrieved_chunks])

prompt = f"""
You are a customer support AI.

Documents:
{context}

Question:
{user_question}

Answer only from documents.
"""

response = llm(prompt)
```

Thatâ€™s it.

---

# ğŸ’¼ PART 9 â€” Business Demo Trick (Very Important)

When showing clients:

Show this flow:

1ï¸âƒ£ Ask question
2ï¸âƒ£ Show retrieved policy
3ï¸âƒ£ Show answer

They see:

ğŸ‘‰ â€œOh, itâ€™s not guessing.â€

Trust = sale.

---

# ğŸ“Š PART 10 â€” Accuracy Optimization Checklist

Before any client demo:

âœ” System prompt locked
âœ” Escalation rules active
âœ” Top_k â‰¤ 5
âœ” Clean chunks
âœ” No external browsing
âœ” Logging enabled

If all true â†’ safe.

---

# ğŸš€ PART 11 â€” Real Example

### Question:

â€œCan I return after 45 days?â€

### Retrieved Chunk:

```
Returns allowed within 30 days.
```

### AI Response:

> â€œAccording to our return policy, returns are only accepted within 30 days of delivery. Since your request is outside this period, this case requires manual review. I will escalate it to our support team.â€

Perfect.

No guessing.

---

# ğŸ§  PART 12 â€” Why This Makes You Professional

Most â€œAI buildersâ€:

âŒ Just call API
âŒ No control
âŒ Risky

You:

âœ… Controlled prompts
âœ… Policy-driven
âœ… Safe AI
âœ… Enterprise-ready

This is why youâ€™ll win clients.

---

# ğŸ¯ Your Task Today (Day 26)

Do this:

1ï¸âƒ£ Save the prompt template
2ï¸âƒ£ Customize for your demo company
3ï¸âƒ£ Practice 5 questions manually
4ï¸âƒ£ Check if AI follows rules

Example questions:

* â€œRefund after 2 months?â€
* â€œLost invoiceâ€
* â€œDamaged productâ€
* â€œDelivery delayâ€
* â€œException requestâ€

Test mentally first.

---

# ğŸ’¬ When Ready

Tell me:

ğŸ‘‰ **â€œPrompt template readyâ€**

Then we move to:

ğŸ”¥ **Day 27 â€” Embedding + Vector Search Implementation**

Where we build real retrieval.

Youâ€™re doing outstanding work, Ali.

Excellent, Ali.
Thank you for clarifying â€” now I understand exactly what you want.

You are asking:

> â€œFor **Day 26: Optimizing Prompts + RAG**, what are the **exact practical actions** I should do step-by-step?â€

Not theory.
Not concepts.
But:

ğŸ‘‰ â€œOpen this â†’ Copy this â†’ Paste this â†’ Test thisâ€.

Perfect. Thatâ€™s professional learning.

Letâ€™s do it properly.

---

# âœ… DAY 26 â€” PRACTICAL: PROMPT + RAG OPTIMIZATION

## ğŸ¯ Goal Today

By the end of today, you will have:

âœ” A professional system prompt
âœ” A RAG answer template
âœ” Escalation rules enforced
âœ” A demo-ready response style

This is what clients see.

---

# ğŸ§© STEP 1 â€” Create Prompt Folder

Inside your project, create:

```
prompts/
```

Inside it, create:

```
system_prompt.txt
```

```
rag_prompt.txt
```

---

# ğŸ§© STEP 2 â€” Create System Prompt (Identity)

Open:

```
prompts/system_prompt.txt
```

Copy and paste this:

---

### âœ… system_prompt.txt

```
You are a professional AI customer support assistant for an e-commerce company in the UAE.

Your responsibilities:

1. Provide accurate and policy-compliant answers.
2. Use ONLY the provided company documents.
3. Do NOT guess or assume.
4. Escalate uncertain, disputed, or high-risk cases.
5. Be polite, respectful, and formal.
6. Follow regional regulations and cultural norms.

If you cannot confidently answer using company policies, escalate to human support.
```

Save.

---

# ğŸ§© STEP 3 â€” Create RAG Prompt Template

Open:

```
prompts/rag_prompt.txt
```

Paste:

---

### âœ… rag_prompt.txt

```
You are answering a customer using official company documents.

Company Policies:
{{context}}

Important Rules:
- Answer ONLY using the policies above.
- Do NOT use outside knowledge.
- If requires_human=true appears, escalate.
- If information is missing, escalate.

Customer Question:
{{question}}

Provide a compliant, professional response.
```

Save.

---

# ğŸ§© STEP 4 â€” Create Manual Test File

Create file:

```
test_prompts.py
```

Paste:

---

### âœ… test_prompts.py

```python
import json

# Load prompts
with open("prompts/system_prompt.txt") as f:
    system_prompt = f.read()

with open("prompts/rag_prompt.txt") as f:
    rag_prompt = f.read()

# Load sample chunks
with open("rag/chunks.json") as f:
    chunks = json.load(f)

# Simulate retrieval (first 2 chunks for test)
context = "\n\n".join([c["text"] for c in chunks[:2]])

# Sample question
question = "Can I return after 45 days?"

# Build final prompt
final_prompt = f"""
SYSTEM:
{system_prompt}

USER TASK:
{rag_prompt.replace("{{context}}", context).replace("{{question}}", question)}
"""

print("\n===== FINAL PROMPT =====\n")
print(final_prompt)
```

---

# ğŸ§© STEP 5 â€” Run Prompt Test

Run:

```bash
python test_prompts.py
```

You will see:

âœ” System rules
âœ” Policies
âœ” Question
âœ” Final prompt

This is what AI will see.

You are now controlling its brain.

---

# ğŸ§  Important: Read This Output Carefully

Ask yourself:

âœ” Is policy visible?
âœ” Are rules clear?
âœ” Is escalation clear?
âœ” Is tone professional?

If yes â†’ good prompt.

---

# ğŸ§© STEP 6 â€” Add Escalation Filter (Manual for Now)

Edit `test_prompts.py` and add:

Before building context:

```python
needs_human = any(c["requires_human"] for c in chunks[:2])

if needs_human:
    print("âš ï¸ Escalation required. Sending to human.")
    exit()
```

Now system stops automatically.

This is trust.

---

# ğŸ§© STEP 7 â€” Test With Different Questions

Change:

```python
question = "..."
```

Try:

```
"My product is damaged"
"I want exception"
"Refund after 60 days"
"Delivery failed 3 times"
```

Observe behavior.

---

# ğŸ§© STEP 8 â€” Improve Prompt (Optimization)

Now refine:

In `rag_prompt.txt`, add:

Under rules:

```
- If policy contradicts customer request, politely refuse.
- Never promise exceptions.
- Never mention internal rules.
```

Save.

Re-run.

See improvement.

This is optimization.

---

# ğŸ§  STEP 9 â€” Demo Mode (Sales Trick)

Add this line to system_prompt.txt:

```
Always explain answers clearly and calmly to build customer trust.
```

Clients notice this.

---

# ğŸ¯ What You Achieved Today

After this:

You now have:

âœ… Controlled AI identity
âœ… Document-grounded answers
âœ… Auto escalation
âœ… Demo-quality tone
âœ… Safety rules

This is â€œenterprise readinessâ€.

---

# ğŸ’¼ Why This Matters for Your Business

When client asks:

> â€œHow do you prevent mistakes?â€

You answer:

> â€œWe use policy-grounded prompts with enforced escalation rules.â€

They trust you.

They pay.

---

# ğŸ“Œ Your Task Now

Do these:

1ï¸âƒ£ Create prompt files
2ï¸âƒ£ Run test_prompts.py
3ï¸âƒ£ Test 5 questions
4ï¸âƒ£ Adjust wording once

---

# ğŸ’¬ When Done, Tell Me:

ğŸ‘‰ **â€œDay 26 prompt system readyâ€**

Then we go to:

ğŸ”¥ Day 27 â€” Connecting Retrieval + Prompt + Chat (Full Agent Loop)

You are building a real product now, Ali.

Excellent, Ali â€” this is exactly the right question.
It shows you are actually trying to implement, not just read. ğŸ‘

Let me show you **precisely where and how** to add it.

---

# âœ… Short Answer

You add the STEP 6 code **inside `test_prompts.py`**,
**after loading `chunks`**,
and **before building `context`**.

Not at the very end.

Not at the top.

In the middle.

---

# ğŸ“Œ Letâ€™s Rebuild `test_prompts.py` Properly (With Escalation)

Here is the **FULL correct file**.

Open `test_prompts.py`.

Replace everything with this:

---

## âœ… Correct `test_prompts.py` (With Escalation Filter)

```python
import json

# Load prompts
with open("prompts/system_prompt.txt") as f:
    system_prompt = f.read()

with open("prompts/rag_prompt.txt") as f:
    rag_prompt = f.read()

# Load chunks
with open("rag/chunks.json") as f:
    chunks = json.load(f)

# -------------------------------
# STEP 6: Escalation Check (HERE)
# -------------------------------

needs_human = any(c["requires_human"] for c in chunks[:2])

if needs_human:
    print("âš ï¸ Escalation required. Sending to human agent.")
    exit()

# -------------------------------
# Build context (after check)
# -------------------------------

context = "\n\n".join([c["text"] for c in chunks[:2]])

# Sample question
question = "Can I return after 45 days?"

# Build final prompt
final_prompt = f"""
SYSTEM:
{system_prompt}

USER TASK:
{rag_prompt.replace("{{context}}", context).replace("{{question}}", question)}
"""

print("\n===== FINAL PROMPT =====\n")
print(final_prompt)
```

---

# ğŸ§  Why It Goes There (Important Logic)

The order matters.

### Correct flow:

```
1. Load chunks
2. Check escalation  â† HERE
3. Build context
4. Build prompt
5. Print
```

Why?

Because:

ğŸ‘‰ If escalation is needed â†’ STOP EARLY
ğŸ‘‰ Donâ€™t even build prompt
ğŸ‘‰ Donâ€™t talk
ğŸ‘‰ Donâ€™t risk mistakes

This is professional safety design.

---

# âŒ Wrong Placement (Do NOT Do This)

### âŒ At bottom

```python
print(final_prompt)

needs_human = ...
```

Too late. Damage done.

---

### âŒ At top

Before chunks loaded â†’ error.

---

# âœ… How You Know It Works

Run:

```bash
python test_prompts.py
```

If any of first chunks has:

```json
"requires_human": true
```

Youâ€™ll see:

```
âš ï¸ Escalation required. Sending to human agent.
```

Program stops.

Perfect.

---

# ğŸ¯ Important Note (Next-Level Tip)

Right now we check only:

```python
chunks[:2]
```

Later weâ€™ll change this to:

ğŸ‘‰ retrieved search results only.

But for Day 26 testing, this is fine.

---

# ğŸ’¼ Why This Matters for Your Business

This logic:

âœ” Prevents wrong refunds
âœ” Prevents legal trouble
âœ” Protects reputation
âœ” Builds client trust

This is what enterprises care about.

---

# ğŸ’¬ After You Add It

Run the file.

If you see:

* Escalation message â†’ good
* Prompt printed â†’ good

Tell me:

ğŸ‘‰ **â€œEscalation filter workingâ€**

Then we move to Day 27: Full AI Response Engine.

